const O={utf16le:"utf-16le",ucs2:"utf-16le",utf16be:"utf-16be"};class p{constructor(e){this.buffer=e,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.pos=0,this.length=this.buffer.length}readString(e,t="ascii"){t=O[t]||t;let s=this.readBuffer(e);try{return new TextDecoder(t).decode(s)}catch{return s}}readBuffer(e){return this.buffer.slice(this.pos,this.pos+=e)}readUInt24BE(){return(this.readUInt16BE()<<8)+this.readUInt8()}readUInt24LE(){return this.readUInt16LE()+(this.readUInt8()<<16)}readInt24BE(){return(this.readInt16BE()<<8)+this.readUInt8()}readInt24LE(){return this.readUInt16LE()+(this.readInt8()<<16)}}p.TYPES={UInt8:1,UInt16:2,UInt24:3,UInt32:4,Int8:1,Int16:2,Int24:3,Int32:4,Float:4,Double:8};for(let o of Object.getOwnPropertyNames(DataView.prototype))if(o.slice(0,3)==="get"){let e=o.slice(3).replace("Ui","UI");e==="Float32"?e="Float":e==="Float64"&&(e="Double");let t=p.TYPES[e];p.prototype["read"+e+(t===1?"":"BE")]=function(){const s=this.view[o](this.pos,!1);return this.pos+=t,s},t!==1&&(p.prototype["read"+e+"LE"]=function(){const s=this.view[o](this.pos,!0);return this.pos+=t,s})}const T=new TextEncoder,b=new Uint8Array(new Uint16Array([4660]).buffer)[0]==18;class g{constructor(e){this.buffer=e,this.view=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),this.pos=0}writeBuffer(e){this.buffer.set(e,this.pos),this.pos+=e.length}writeString(e,t="ascii"){let s;switch(t){case"utf16le":case"utf16-le":case"ucs2":s=E(e,b);break;case"utf16be":case"utf16-be":s=E(e,!b);break;case"utf8":s=T.encode(e);break;case"ascii":s=L(e);break;default:throw new Error(`Unsupported encoding: ${t}`)}this.writeBuffer(s)}writeUInt24BE(e){this.buffer[this.pos++]=e>>>16&255,this.buffer[this.pos++]=e>>>8&255,this.buffer[this.pos++]=e&255}writeUInt24LE(e){this.buffer[this.pos++]=e&255,this.buffer[this.pos++]=e>>>8&255,this.buffer[this.pos++]=e>>>16&255}writeInt24BE(e){e>=0?this.writeUInt24BE(e):this.writeUInt24BE(e+16777215+1)}writeInt24LE(e){e>=0?this.writeUInt24LE(e):this.writeUInt24LE(e+16777215+1)}fill(e,t){if(t<this.buffer.length)this.buffer.fill(e,this.pos,this.pos+t),this.pos+=t;else{const s=new Uint8Array(t);s.fill(e),this.writeBuffer(s)}}}function E(o,e){let t=new Uint16Array(o.length);for(let s=0;s<o.length;s++){let i=o.charCodeAt(s);e&&(i=i>>8|(i&255)<<8),t[s]=i}return new Uint8Array(t.buffer)}function L(o){let e=new Uint8Array(o.length);for(let t=0;t<o.length;t++)e[t]=o.charCodeAt(t);return e}for(let o of Object.getOwnPropertyNames(DataView.prototype))if(o.slice(0,3)==="set"){let e=o.slice(3).replace("Ui","UI");e==="Float32"?e="Float":e==="Float64"&&(e="Double");let t=p.TYPES[e];g.prototype["write"+e+(t===1?"":"BE")]=function(s){this.view[o](this.pos,s,!1),this.pos+=t},t!==1&&(g.prototype["write"+e+"LE"]=function(s){this.view[o](this.pos,s,!0),this.pos+=t})}class c{fromBuffer(e){let t=new p(e);return this.decode(t)}toBuffer(e){let t=this.size(e),s=new Uint8Array(t),i=new g(s);return this.encode(i,e),s}}class l extends c{constructor(e,t="BE"){super(),this.type=e,this.endian=t,this.fn=this.type,this.type[this.type.length-1]!=="8"&&(this.fn+=this.endian)}size(){return p.TYPES[this.type]}decode(e){return e[`read${this.fn}`]()}encode(e,t){return e[`write${this.fn}`](t)}}const v=new l("UInt8"),_=new l("UInt16","BE"),$=_,j=new l("UInt16","LE"),k=new l("UInt24","BE"),C=k;new l("UInt24","LE");const x=new l("UInt32","BE"),G=x,Y=new l("UInt32","LE"),M=new l("Int8"),S=new l("Int16","BE"),R=S;new l("Int16","LE");new l("Int24","BE");new l("Int24","LE");const A=new l("Int32","BE"),W=A;new l("Int32","LE");new l("Float","BE");new l("Float","LE");new l("Double","BE");new l("Double","LE");class a extends l{constructor(e,t,s=e>>1){super(`Int${e}`,t),this._point=1<<s}decode(e){return super.decode(e)/this._point}encode(e,t){return super.encode(e,t*this._point|0)}}const P=new a(16,"BE"),q=P;new a(16,"LE");const F=new a(32,"BE"),H=F;new a(32,"LE");function u(o,e,t){let s;if(typeof o=="number"?s=o:typeof o=="function"?s=o.call(t,t):t&&typeof o=="string"?s=t[o]:e&&o instanceof l&&(s=o.decode(e)),isNaN(s))throw new Error("Not a fixed size");return s}class U{constructor(e={}){this.enumerable=!0,this.configurable=!0;for(let t in e){const s=e[t];this[t]=s}}}class D extends c{constructor(e,t,s="count"){super(),this.type=e,this.length=t,this.lengthType=s}decode(e,t){let s;const{pos:i}=e,n=[];let r=t;if(this.length!=null&&(s=u(this.length,e,t)),this.length instanceof l&&(Object.defineProperties(n,{parent:{value:t},_startOffset:{value:i},_currentOffset:{value:0,writable:!0},_length:{value:s}}),r=n),s==null||this.lengthType==="bytes"){const f=s!=null?e.pos+s:t!=null&&t._length?t._startOffset+t._length:e.length;for(;e.pos<f;)n.push(this.type.decode(e,r))}else for(let f=0,h=s;f<h;f++)n.push(this.type.decode(e,r));return n}size(e,t,s=!0){if(!e)return this.type.size(null,t)*u(this.length,null,t);let i=0;this.length instanceof l&&(i+=this.length.size(),t={parent:t,pointerSize:0});for(let n of e)i+=this.type.size(n,t);return t&&s&&this.length instanceof l&&(i+=t.pointerSize),i}encode(e,t,s){let i=s;this.length instanceof l&&(i={pointers:[],startOffset:e.pos,parent:s},i.pointerOffset=e.pos+this.size(t,i,!1),this.length.encode(e,t.length));for(let n of t)this.type.encode(e,n,i);if(this.length instanceof l){let n=0;for(;n<i.pointers.length;){const r=i.pointers[n++];r.type.encode(e,r.val,r.parent)}}}}class J extends D{decode(e,t){const{pos:s}=e,i=u(this.length,e,t);this.length instanceof l&&(t={parent:t,_startOffset:s,_currentOffset:0,_length:i});const n=new y(this.type,i,e,t);return e.pos+=i*this.type.size(null,t),n}size(e,t){return e instanceof y&&(e=e.toArray()),super.size(e,t)}encode(e,t,s){return t instanceof y&&(t=t.toArray()),super.encode(e,t,s)}}class y{constructor(e,t,s,i){this.type=e,this.length=t,this.stream=s,this.ctx=i,this.base=this.stream.pos,this.items=[]}get(e){if(!(e<0||e>=this.length)){if(this.items[e]==null){const{pos:t}=this.stream;this.stream.pos=this.base+this.type.size(null,this.ctx)*e,this.items[e]=this.type.decode(this.stream,this.ctx),this.stream.pos=t}return this.items[e]}}toArray(){const e=[];for(let t=0,s=this.length;t<s;t++)e.push(this.get(t));return e}}class K extends c{constructor(e,t=[]){super(),this.type=e,this.flags=t}decode(e){const t=this.type.decode(e),s={};for(let i=0;i<this.flags.length;i++){const n=this.flags[i];n!=null&&(s[n]=!!(t&1<<i))}return s}size(){return this.type.size()}encode(e,t){let s=0;for(let i=0;i<this.flags.length;i++){const n=this.flags[i];n!=null&&t[n]&&(s|=1<<i)}return this.type.encode(e,s)}}class Q extends c{constructor(e){super(),this.length=e}decode(e,t){const s=u(this.length,e,t);return e.readBuffer(s)}size(e,t){if(!e)return u(this.length,null,t);let s=e.length;return this.length instanceof l&&(s+=this.length.size()),s}encode(e,t,s){return this.length instanceof l&&this.length.encode(e,t.length),e.writeBuffer(t)}}class X extends c{constructor(e,t=!0){super(),this.type=e,this.condition=t}decode(e,t){let{condition:s}=this;if(typeof s=="function"&&(s=s.call(t,t)),s)return this.type.decode(e,t)}size(e,t){let{condition:s}=this;return typeof s=="function"&&(s=s.call(t,t)),s?this.type.size(e,t):0}encode(e,t,s){let{condition:i}=this;if(typeof i=="function"&&(i=i.call(s,s)),i)return this.type.encode(e,t,s)}}class Z extends c{constructor(e,t=1){super(),this.type=e,this.count=t}decode(e,t){e.pos+=this.size(null,t)}size(e,t){const s=u(this.count,null,t);return this.type.size()*s}encode(e,t,s){return e.fill(0,this.size(t,s))}}class m extends c{constructor(e,t="ascii"){super(),this.length=e,this.encoding=t}decode(e,t){let s,i,{encoding:n}=this;typeof n=="function"&&(n=n.call(t,t)||"ascii");let r=w(n);if(this.length!=null)s=u(this.length,e,t);else{let h;for({buffer:h,length:s,pos:i}=e;i<s-r+1&&(h[i]!==0||r===2&&h[i+1]!==0);)i+=r;s=i-e.pos}const f=e.readString(s,n);return this.length==null&&e.pos<e.length&&(e.pos+=r),f}size(e,t){if(e==null)return u(this.length,null,t);let{encoding:s}=this;typeof s=="function"&&(s=s.call(t!=null?t.val:void 0,t!=null?t.val:void 0)||"ascii"),s==="utf16be"&&(s="utf16le");let i=z(e,s);return this.length instanceof l&&(i+=this.length.size()),this.length==null&&(i+=w(s)),i}encode(e,t,s){let{encoding:i}=this;if(typeof i=="function"&&(i=i.call(s!=null?s.val:void 0,s!=null?s.val:void 0)||"ascii"),this.length instanceof l&&this.length.encode(e,z(t,i)),e.writeString(t,i),this.length==null)return w(i)==2?e.writeUInt16LE(0):e.writeUInt8(0)}}function w(o){switch(o){case"ascii":case"utf8":return 1;case"utf16le":case"utf16-le":case"utf16be":case"utf16-be":case"ucs2":return 2;default:throw new Error("Unknown encoding "+o)}}function z(o,e){switch(e){case"ascii":return o.length;case"utf8":let t=0;for(let s=0;s<o.length;s++){let i=o.charCodeAt(s);if(i>=55296&&i<=56319&&s<o.length-1){let n=o.charCodeAt(++s);(n&64512)===56320?i=((i&1023)<<10)+(n&1023)+65536:s--}i&4294967168?i&4294965248?i&4294901760?i&4292870144||(t+=4):t+=3:t+=2:t++}return t;case"utf16le":case"utf16-le":case"utf16be":case"utf16-be":case"ucs2":return o.length*2;default:throw new Error("Unknown encoding "+e)}}class N extends c{constructor(e={}){super(),this.fields=e}decode(e,t,s=0){const i=this._setup(e,t,s);return this._parseFields(e,i,this.fields),this.process!=null&&this.process.call(i,e),i}_setup(e,t,s){const i={};return Object.defineProperties(i,{parent:{value:t},_startOffset:{value:e.pos},_currentOffset:{value:0,writable:!0},_length:{value:s}}),i}_parseFields(e,t,s){for(let n in s){var i;const r=s[n];typeof r=="function"?i=r.call(t,t):i=r.decode(e,t),i!==void 0&&(i instanceof U?Object.defineProperty(t,n,i):t[n]=i),t._currentOffset=e.pos-t._startOffset}}size(e,t,s=!0){e==null&&(e={});const i={parent:t,val:e,pointerSize:0};this.preEncode!=null&&this.preEncode.call(e);let n=0;for(let r in this.fields){const f=this.fields[r];f.size!=null&&(n+=f.size(e[r],i))}return s&&(n+=i.pointerSize),n}encode(e,t,s){let i;this.preEncode!=null&&this.preEncode.call(t,e);const n={pointers:[],startOffset:e.pos,parent:s,val:t,pointerSize:0};n.pointerOffset=e.pos+this.size(t,n,!1);for(let f in this.fields)i=this.fields[f],i.encode!=null&&i.encode(e,t[f],n);let r=0;for(;r<n.pointers.length;){const f=n.pointers[r++];f.type.encode(e,f.val,f.parent)}}}const V=(o,e)=>e.reduce((t,s)=>t&&t[s],o);class B extends N{constructor(e,t={}){super(),this.type=e,this.versions=t,typeof e=="string"&&(this.versionPath=e.split("."))}decode(e,t,s=0){const i=this._setup(e,t,s);typeof this.type=="string"?i.version=V(t,this.versionPath):i.version=this.type.decode(e),this.versions.header&&this._parseFields(e,i,this.versions.header);const n=this.versions[i.version];if(n==null)throw new Error(`Unknown version ${i.version}`);return n instanceof B?n.decode(e,t):(this._parseFields(e,i,n),this.process!=null&&this.process.call(i,e),i)}size(e,t,s=!0){let i,n;if(!e)throw new Error("Not a fixed size");this.preEncode!=null&&this.preEncode.call(e);const r={parent:t,val:e,pointerSize:0};let f=0;if(typeof this.type!="string"&&(f+=this.type.size(e.version,r)),this.versions.header)for(i in this.versions.header)n=this.versions.header[i],n.size!=null&&(f+=n.size(e[i],r));const h=this.versions[e.version];if(h==null)throw new Error(`Unknown version ${e.version}`);for(i in h)n=h[i],n.size!=null&&(f+=n.size(e[i],r));return s&&(f+=r.pointerSize),f}encode(e,t,s){let i,n;this.preEncode!=null&&this.preEncode.call(t,e);const r={pointers:[],startOffset:e.pos,parent:s,val:t,pointerSize:0};if(r.pointerOffset=e.pos+this.size(t,r,!1),typeof this.type!="string"&&this.type.encode(e,t.version),this.versions.header)for(i in this.versions.header)n=this.versions.header[i],n.encode!=null&&n.encode(e,t[i],r);const f=this.versions[t.version];for(i in f)n=f[i],n.encode!=null&&n.encode(e,t[i],r);let h=0;for(;h<r.pointers.length;){const d=r.pointers[h++];d.type.encode(e,d.val,d.parent)}}}class ee extends c{constructor(e,t,s={}){if(super(),this.offsetType=e,this.type=t,this.options=s,this.type==="void"&&(this.type=null),this.options.type==null&&(this.options.type="local"),this.options.allowNull==null&&(this.options.allowNull=!0),this.options.nullValue==null&&(this.options.nullValue=0),this.options.lazy==null&&(this.options.lazy=!1),this.options.relativeTo){if(typeof this.options.relativeTo!="function")throw new Error("relativeTo option must be a function");this.relativeToGetter=s.relativeTo}}decode(e,t){const s=this.offsetType.decode(e,t);if(s===this.options.nullValue&&this.options.allowNull)return null;let i;switch(this.options.type){case"local":i=t._startOffset;break;case"immediate":i=e.pos-this.offsetType.size();break;case"parent":i=t.parent._startOffset;break;default:for(var n=t;n.parent;)n=n.parent;i=n._startOffset||0}this.options.relativeTo&&(i+=this.relativeToGetter(t));const r=s+i;if(this.type!=null){let f=null;const h=()=>{if(f!=null)return f;const{pos:d}=e;return e.pos=r,f=this.type.decode(e,t),e.pos=d,f};return this.options.lazy?new U({get:h}):h()}else return r}size(e,t){const s=t;switch(this.options.type){case"local":case"immediate":break;case"parent":t=t.parent;break;default:for(;t.parent;)t=t.parent}let{type:i}=this;if(i==null){if(!(e instanceof I))throw new Error("Must be a VoidPointer");({type:i}=e),e=e.value}if(e&&t){let n=i.size(e,s);t.pointerSize+=n}return this.offsetType.size()}encode(e,t,s){let i;const n=s;if(t==null){this.offsetType.encode(e,this.options.nullValue);return}switch(this.options.type){case"local":i=s.startOffset;break;case"immediate":i=e.pos+this.offsetType.size(t,n);break;case"parent":s=s.parent,i=s.startOffset;break;default:for(i=0;s.parent;)s=s.parent}this.options.relativeTo&&(i+=this.relativeToGetter(n.val)),this.offsetType.encode(e,s.pointerOffset-i);let{type:r}=this;if(r==null){if(!(t instanceof I))throw new Error("Must be a VoidPointer");({type:r}=t),t=t.value}return s.pointers.push({type:r,val:t,parent:n}),s.pointerOffset+=r.size(t,n)}}class I{constructor(e,t){this.type=e,this.value=t}}export{D as A,K as B,p as D,g as E,a as F,J as L,l as N,X as O,ee as P,Z as R,N as S,B as V,G as a,C as b,v as c,W as d,m as e,H as f,Q as g,M as h,R as i,q as j,I as k,U as l,_ as m,j as n,x as o,Y as p,u as r,$ as u};
